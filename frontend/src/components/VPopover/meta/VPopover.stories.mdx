import {
  ArgsTable,
  Canvas,
  Description,
  Meta,
  Story,
} from "@storybook/addon-docs"

import { placements as popoverPlacements } from "@popperjs/core"
import { log } from "~/utils/console"

import VPopover from "~/components/VPopover/VPopover.vue"
import VButton from "~/components/VButton.vue"

<Meta title="Components/VPopover" components={VPopover} argTypes={{}} />

export const popoverArgTypes = {
  hideOnEsc: { control: { type: "boolean" } },
  hideOnClickOutside: { control: { type: "boolean" } },
  autoFocusOnShow: { control: { type: "boolean" } },
  autoFocusOnHide: { control: { type: "boolean" } },
  placement: { options: [...popoverPlacements], control: { type: "radio" } },
  label: { control: { type: "text" } },
  labelledBy: { control: { type: "text" } },
  close: { action: "close" },
  open: { action: "open" },
}

export const SinglePopoverStory = (args) => ({
  template: `
    <div>
      <p>
        This story is configured to log when the popover opens or closes. Inspect the console output to observe this behavior.
      </p>
      <div tabindex="0">Focusable external area</div>
      <VPopover v-bind="args" v-on="args">
        <template #trigger="{ visible, a11yProps }">
          <VButton :pressed="visible" v-bind="a11yProps">{{ visible ? 'Close' : 'Open' }}</VButton>
        </template>
        <div class="py-1 px-2">Code is Poetry</div>
      </VPopover>
    </div>
  `,
  components: { VPopover, VButton },
  setup() {
    return { args }
  },
})

export const ControlStory = (args) => ({
  template: `
    <VPopover v-bind="args" v-on="args">
      <template #trigger="{ visible, a11yProps }">
        <VButton :pressed="visible" v-bind="a11yProps">{{ visible ? 'Close' : 'Open' }}</VButton>
      </template>
      <template #default="{ close }">
        <div class="p-4">
        <VButton @click="close">Close popover</VButton>
        </div>
      </template>
    </VPopover>
  `,
  components: { VPopover, VButton },
  setup() {
    return { args }
  },
})

export const TwoPopoverStory = (args) => ({
  template: `
    <div>
      <VPopover label="First popover" v-bind="args" v-on="args">
        <template #trigger="{ visible, a11yProps }">
          <VButton :pressed="visible" v-bind="a11yProps">{{ visible ? 'First popover open' : 'First popover closed' }}</VButton>
        </template>
        <div class="py-1 px-2">First popover content</div>
      </VPopover>
      <div class="h-5">Some content</div>
      <VPopover label="Second popover" v-bind="args" v-on="args">
        <template #trigger="{ visible, a11yProps }">
          <VButton :pressed="visible" v-bind="a11yProps">{{ visible ? 'Second popover open' : 'Second popover closed' }}</VButton>
        </template>
        <div class="py-1 px-2">Second popover content</div>
      </VPopover>
    </div>
  `,
  components: { VPopover, VButton },
  setup() {
    return { args }
  },
})

<Description of={VPopover} />

<ArgsTable of={VPopover} />

## Default VPopover

<Canvas>
  <Story name="Default" argTypes={popoverArgTypes}>
    {SinglePopoverStory.bind({})}
  </Story>
</Canvas>

## Control VPopover

<Canvas>
  <Story name="Control" argTypes={popoverArgTypes}>
    {ControlStory.bind({})}
  </Story>
</Canvas>

## Two VPopover

<Canvas>
  <Story name="Two Popovers" argTypes={popoverArgTypes}>
    {TwoPopoverStory.bind({})}
  </Story>
</Canvas>
