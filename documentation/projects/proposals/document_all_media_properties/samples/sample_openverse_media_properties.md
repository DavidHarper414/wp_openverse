# Openverse Media Properties

_This document is auto-generated from the source code in
`utilities/media_props_gen/media_props_generation.py`. _

This is a list of the media properties, with the descriptions of corresponding
database columns and Python objects that are used to store and retrieve media
data. The order of the properties corresponds to their order in the `image_view`
materialized view.

## `image_view` properties

| DB Field     | DB Nullable | DB Type | Python Column                                                                                                                                                                                         | Description                |
| ------------ | ----------- | ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------- |
| `identifier` | True        | uuid    | [UUIDColumn](https://github.com/WordPress/openverse-catalog/blob/main/openverse_catalog/dags/common/storage/columns.py#L438-L455)(nullable=True, required=False, upsert_strategy=newest_non_null))    | UUID generated by Postgres |
| `tags`       | True        | jsonb   | [JSONColumn](https://github.com/WordPress/openverse-catalog/blob/main/openverse_catalog/dags/common/storage/columns.py#L326-L392)(nullable=True, required=False, upsert_strategy=merge_jsonb_arrays)) | A list of tag objects      |

### Media Properties

#### `identifier`

Used for `image` and `audio` Openverse `identifier` is generated during the
ingestion process when the image is inserted into the `image` table for the
first time.

#### `tags`

Used for `image` and `audio` Name in `add_item`: `raw_tags`

The list of short descriptive labels or keywords for the media item. Provider
scripts collect tags as a list of strings. The `MediaStore` converts each tag
into a dictionary with `name` and `provider` properties. For example, ["tag1"]
becomes `{ "name": "tag1", "provider": "provider1"}`. Some redundant tags (such
as `uploaded_by` or the tags with licenses) are filtered out in the
`MediaStore`. Some images also have AI-generated tags from `clarifai` and
`Recognition`. These tags contain the label of what is in the image, with the
accuracy of detection
(`{ "name": "cat", "accuracy": 0.95, "provider": "clarifai"}`). It was
previously determined that tags with an accuracy score below 0.90 are often
unreliable, so those tags are discarded during the
[data cleanup process](https://github.com/WordPress/openverse/blob/a281dc472fbca281bfaa623ebe5ec0b0feab31ee/ingestion_server/ingestion_server/cleanup.py#L114)
in the `ingestion_server`.

Provider API scripts collect the following items as tags: `finnish_museums`
(`subjects`), `flickr` (tags, discards tags that are longer than max_length and
sorts them for consistency), `inaturalist`(taxons),
`metropolitan_museum`(department, medium, culture, objectName, artist name,
classification, object date, credit line, period, tags), `nappy` (tags), `nypl`
(tags are inside meta_data), `rawpixel` (popular_keywords excluding the license
names - should remove this to rely on MediaStore?), `smithsonian`
(indexedStructured), `stocksnap` (keywords), `wordpress` (photo_tag). #TODO: Fix
`nypl` tags collection #TODO: Remove `rawpixel` tag filtering

Some tags collected in the beginning had incorrectly escaped Unicode characters.
When the items were updated during data refresh, both the correct and incorrect
tags were saved because they were different. This is mitigated in
[Nuxt](https://github.com/WordPress/openverse/blob/a281dc472fbca281bfaa623ebe5ec0b0feab31ee/frontend/src/utils/decode-media-data.ts#L95).

### Common issues

#### Incorrectly escaped Unicode characters

In: `title`, `tags`, `creator` Sometimes, Unicode characters were encoded
incorrectly. Symbols like `\u<xxxx>` were saved as either `\\u<xxxx>` or
`u<xxxx>`. Thus, instead of showing the non-ascii symbols, they are shown as
gibberish in the UI. This is addressed in the Nuxt front end. When data refresh
is run, the incorrect values can be replaced if the `upsert_strategy` for the
column is `newest_non_null`. However, for the strategies that update the value
instead of replacing it, this results in duplication of the values. Thus, some
items have duplicated tags: the correctly-encoded tags cannot replace the
incorrectly-encoded tags because they are different.
